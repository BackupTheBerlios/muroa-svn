#ifndef CSTATEMACHINE_H
#define CSTATEMACHINE_H

#include <QObject>
#include <QTcpSocket>
#include <QXmlInputSource>

#include "ccontenthandler.h"

class QXmlSimpleReader;
class QXmlStreamWriter;

class CStateMachine : public QObject
{
    Q_OBJECT;
public:
    CStateMachine();
    ~CStateMachine();

signals:
    void connectionStatusChanged(QString message);


public slots:
    void close();
    void open(QString host, int port);

    void write8(u_int32_t offset, u_int8_t value);
    u_int32_t read8(u_int32_t offset);

    void connected();
    void disconnected();
    void error();

    void readyRead();

    void test();


private:
    QTcpSocket m_socket;
    CContentHandler m_contentHandler;
    QXmlInputSource m_xml_src;
    QXmlSimpleReader *m_xml_reader;
    QXmlStreamWriter *m_xml_writer;

    int m_state;
    int m_xml_depth;

};

#endif // CSTATEMACHINE_H
